From ad3dac40e5b8bde42fea55b89f52be1ce1fc553a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Eric=20B=C3=A9nard?= <eric@eukrea.com>
Date: Fri, 31 Aug 2012 20:54:21 +0200
Subject: [PATCH 24/24] ipu: hack to fix wrong colors
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

this problem we seen on some parts which always exhibit the problem
and seems to be caused by the hard reset of the IPU

Signed-off-by: Eric BÃ©nard <eric@eukrea.com>
---
 drivers/mfd/imx-ipu-v3/ipu-common.c |    9 +++++----
 1 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/drivers/mfd/imx-ipu-v3/ipu-common.c b/drivers/mfd/imx-ipu-v3/ipu-common.c
index 9701bef..e956c0a 100644
--- a/drivers/mfd/imx-ipu-v3/ipu-common.c
+++ b/drivers/mfd/imx-ipu-v3/ipu-common.c
@@ -353,10 +353,10 @@ static int ipu_reset(void)
 	u32 val;
 
 	/* hard reset the IPU */
-	val = readl(MX51_IO_ADDRESS(MX51_SRC_BASE_ADDR));
+/*	val = readl(MX51_IO_ADDRESS(MX51_SRC_BASE_ADDR));
 	val |= 1 << 3;
 	writel(val, MX51_IO_ADDRESS(MX51_SRC_BASE_ADDR));
-
+*/
 	ipu_cm_write(0x807FFFFF, IPU_MEM_RST);
 
 	while (ipu_cm_read(IPU_MEM_RST) & 0x80000000) {
@@ -394,9 +394,10 @@ static int __devinit ipu_mipi_setup(void)
 	__raw_writel(0xF00, hsc_addr);
 
 	/* CSI mode: reserved; DI control mode: legacy (from Freescale BSP) */
-	__raw_writel(__raw_readl(hsc_addr + 0x800) | 0x30ff,
+	__raw_writel(__raw_readl(hsc_addr + 0x800) | 0xf,
+		hsc_addr + 0x800);
+	__raw_writel(__raw_readl(hsc_addr + 0x800) | 0x10000,
 		hsc_addr + 0x800);
-
 	clk_disable(hsc_clk);
 	clk_put(hsc_clk);
 unmap:
-- 
1.7.7.6

